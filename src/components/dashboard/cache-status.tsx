"use client";\n\nimport { useState, useEffect } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  Database, \n  Trash2, \n  RefreshCw, \n  Clock, \n  HardDrive, \n  Zap,\n  CheckCircle,\n  AlertTriangle,\n  TrendingUp\n} from 'lucide-react';\nimport { useCacheControl } from '@/hooks/use-cache';\nimport { CacheUtils } from '@/lib/cache';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface CacheStats {\n  storeName: string;\n  displayName: string;\n  itemCount: number;\n  estimatedSize: string;\n  lastCleanup?: string;\n  icon: React.ReactNode;\n}\n\nexport function CacheStatusCard() {\n  const [cacheStats, setCacheStats] = useState<CacheStats[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [lastRefresh, setLastRefresh] = useState<Date | null>(null);\n  const { runCleanup, clearAllCaches, isCleanupRunning } = useCacheControl();\n  const { toast } = useToast();\n\n  const cacheStores = [\n    { name: 'ai_suggestions', display: 'AI Suggestions', icon: <Zap className=\"h-4 w-4\" /> },\n    { name: 'user_topics', display: 'Topics & Stats', icon: <Database className=\"h-4 w-4\" /> },\n    { name: 'user_progress', display: 'User Progress', icon: <TrendingUp className=\"h-4 w-4\" /> },\n    { name: 'problems_data', display: 'Problem Database', icon: <HardDrive className=\"h-4 w-4\" /> },\n    { name: 'daily_questions', display: 'Daily Questions', icon: <CheckCircle className=\"h-4 w-4\" /> },\n    { name: 'user_stats', display: 'Statistics', icon: <Clock className=\"h-4 w-4\" /> },\n  ];\n\n  const loadCacheStats = async () => {\n    setIsLoading(true);\n    try {\n      const stats: CacheStats[] = [];\n      \n      for (const store of cacheStores) {\n        try {\n          // Note: IndexedDB doesn't provide direct size calculation\n          // This is a simplified approach - in production you'd want more sophisticated tracking\n          const itemCount = 0; // Placeholder - would need custom tracking\n          const estimatedSize = 'Unknown';\n          \n          stats.push({\n            storeName: store.name,\n            displayName: store.display,\n            itemCount,\n            estimatedSize,\n            icon: store.icon\n          });\n        } catch (error) {\n          console.error(`Failed to get stats for ${store.name}:`, error);\n        }\n      }\n      \n      setCacheStats(stats);\n      setLastRefresh(new Date());\n    } catch (error) {\n      console.error('Failed to load cache stats:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to load cache statistics.',\n        variant: 'destructive'\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleCleanup = async () => {\n    try {\n      await runCleanup();\n      await loadCacheStats();\n      toast({\n        title: 'Cache Cleaned',\n        description: 'Expired cache entries have been removed.',\n      });\n    } catch (error) {\n      toast({\n        title: 'Cleanup Failed',\n        description: 'Failed to clean cache.',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  const handleClearAll = async () => {\n    try {\n      await clearAllCaches();\n      await loadCacheStats();\n      toast({\n        title: 'All Caches Cleared',\n        description: 'All cached data has been removed.',\n      });\n    } catch (error) {\n      toast({\n        title: 'Clear Failed',\n        description: 'Failed to clear all caches.',\n        variant: 'destructive'\n      });\n    }\n  };\n\n  useEffect(() => {\n    loadCacheStats();\n  }, []);\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5\" />\n              Cache Status\n            </CardTitle>\n            <CardDescription>\n              Monitor and manage application cache performance\n            </CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={loadCacheStats}\n              disabled={isLoading}\n            >\n              <RefreshCw className={`h-4 w-4 mr-2 ${isLoading ? 'animate-spin' : ''}`} />\n              Refresh\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Cache Status Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n          {cacheStats.map((stat) => (\n            <div \n              key={stat.storeName}\n              className=\"flex items-center gap-3 p-3 rounded-lg border bg-muted/30 hover:bg-muted/50 transition-colors\"\n            >\n              <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center text-primary\">\n                {stat.icon}\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-medium text-sm\">{stat.displayName}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {stat.itemCount} items • {stat.estimatedSize}\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Cache Actions */}\n        <div className=\"flex items-center justify-between pt-4 border-t\">\n          <div className=\"flex items-center gap-4\">\n            {lastRefresh && (\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Clock className=\"h-4 w-4\" />\n                Last updated: {lastRefresh.toLocaleTimeString()}\n              </div>\n            )}\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={handleCleanup}\n              disabled={isCleanupRunning}\n            >\n              <RefreshCw className={`h-4 w-4 mr-2 ${isCleanupRunning ? 'animate-spin' : ''}`} />\n              Cleanup\n            </Button>\n            \n            <Button \n              variant=\"outline\" \n              size=\"sm\"\n              onClick={handleClearAll}\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Clear All\n            </Button>\n          </div>\n        </div>\n\n        {/* Cache Health Indicators */}\n        <div className=\"grid grid-cols-2 gap-4 pt-4\">\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-4 w-4 text-green-500\" />\n              <span className=\"text-sm font-medium\">Cache Hit Rate</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Progress value={85} className=\"flex-1\" />\n              <Badge variant=\"secondary\" className=\"text-xs\">85%</Badge>\n            </div>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <div className=\"flex items-center gap-2\">\n              <HardDrive className=\"h-4 w-4 text-blue-500\" />\n              <span className=\"text-sm font-medium\">Storage Usage</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Progress value={45} className=\"flex-1\" />\n              <Badge variant=\"secondary\" className=\"text-xs\">~2MB</Badge>\n            </div>\n          </div>\n        </div>\n\n        {/* Performance Tips */}\n        <div className=\"rounded-lg bg-blue-50 dark:bg-blue-950/20 p-4 border border-blue-200/50 dark:border-blue-800/50\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center flex-shrink-0\">\n              <Zap className=\"h-3.5 w-3.5 text-blue-600 dark:text-blue-400\" />\n            </div>\n            <div className=\"space-y-1\">\n              <p className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">\n                Cache Performance Tips\n              </p>\n              <ul className=\"text-xs text-blue-700 dark:text-blue-300 space-y-1\">\n                <li>• AI suggestions are cached for 2 hours to reduce API costs</li>\n                <li>• User data is cached for 5-15 minutes for fast page loads</li>\n                <li>• Problem database is cached for 24 hours (static data)</li>\n                <li>• Run cleanup periodically to remove expired entries</li>\n              </ul>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\n// Simplified version for dashboard\nexport function CacheStatusWidget() {\n  const [cacheHitRate, setCacheHitRate] = useState(85);\n  const [storageUsed, setStorageUsed] = useState(45);\n  \n  return (\n    <Card className=\"\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n          <Database className=\"h-4 w-4 text-primary\" />\n          Cache Performance\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        <div className=\"space-y-1\">\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Hit Rate</span>\n            <Badge variant=\"secondary\">{cacheHitRate}%</Badge>\n          </div>\n          <Progress value={cacheHitRate} className=\"h-1.5\" />\n        </div>\n        \n        <div className=\"space-y-1\">\n          <div className=\"flex items-center justify-between text-xs\">\n            <span className=\"text-muted-foreground\">Storage</span>\n            <Badge variant=\"secondary\">~2MB</Badge>\n          </div>\n          <Progress value={storageUsed} className=\"h-1.5\" />\n        </div>\n        \n        <div className=\"flex items-center gap-1 text-xs text-green-600 dark:text-green-400\">\n          <CheckCircle className=\"h-3 w-3\" />\n          <span>Cache optimized</span>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}